import{ao as Q,aM as z,ad as O,aj as _,aN as Y,ax as b,ay as S,b1 as Z,az as o,aw as d,u as D,b2 as F,b3 as ee,b4 as H,r as k,b5 as te,ab as re,j as t,B as T,a5 as K,I as B,P as V,T as ne,a as f,aX as ae,b6 as se,b7 as ie}from"./index-wQ8JwfM2.js";import{a as oe}from"./index-k6g5FF0C.js";import{Q as ce}from"./useQueryLecturer-y1xKae_S.js";import{a as le,b as ue,c as de,l as he,d as pe,e as ye,r as ge}from"./apiStudent-mO15R6c8.js";import{u as W}from"./useQueryLecturerTerm-QglJ35an.js";import{a as ve}from"./Table-cDawzk-H.js";var X=(e=>(e.getAllStudent="getAllStudent",e.getStudentById="getStudentById",e.searchStudentByField="searchStudentByField",e.managerActionStudent="managerActionStudent",e))(X||{});const Ne=()=>{const{enqueueSnackbar:e}=Q(),r=z(a=>a.studentSlice),{paramTotalPage:n}=r,{termStore:l}=O(),{majorStore:x}=_(),g=x.currentMajor.id,h=l.currentTerm.id,{getQueryField:s,setTotalPage:c}=W(),u=Y();return{paramTotalPage:n,studentStore:r,onResetPassword:()=>S(a=>ge(a),{onSuccess(a){a.success&&e("Cấp lại mật khẩu thành công",{variant:"success"})},onError(a){a.status===404?e(a.message,{variant:"error"}):e("Cập nhật mật khẩu thất bại",{variant:"error"})}}),onLockOnlyStudent:a=>S(y=>he(a,y),{onSuccess(y){y.success&&(e("sinh viên thành công!",{variant:"success"}),o.invalidateQueries({queryKey:["getAllStudent",h,g,s("limit"),s("page"),s("searchField"),s("keywords")]}),o.invalidateQueries({queryKey:["get-student-by-id",a]}))}}),handleGetStudentById:a=>b(["getStudentById",a],()=>ue(a),{enabled:!!a,cacheTime:1e3*(60*1)}),onUpdateStudent:a=>S(y=>de(a,y),{onSuccess(y){y.student&&e("Cập nhật sinh viên thành công",{variant:"success"}),o.invalidateQueries({queryKey:["getAllStudent",h,g,s("limit"),s("page"),s("searchField"),s("keywords")]}),o.invalidateQueries({queryKey:["getStudentById",a]})},onError(){e("Cập nhật sinh viên thất bại, thử lại",{variant:"error"})}}),onCreateStudent:()=>S(a=>pe(a),{onSuccess(a){a.success&&(e("Tạo sinh viên thành công",{variant:"success"}),o.invalidateQueries({queryKey:["getAllStudent",h,g,s("limit"),s("page"),s("searchField"),s("keywords")]}))},onError(){e("Tạo sinh viên thất bại, thử lại",{variant:"error"})}}),handleGetAllStudent:()=>b(["getAllStudent",h,g,s("limit"),s("page"),s("searchField"),s("keywords")],()=>le(h,g,s("limit"),s("page"),s("searchField"),s("keywords")),{onSuccess(a){const y=a.params?a.params.totalPage:0;u(Z(y)),c(y)},staleTime:1e3*(60*10),refetchInterval:1e3*(60*20),keepPreviousData:!0}),onDeleteStudent:()=>S(a=>ye(a),{onSuccess(a){a.success&&(e("Xóa sinh viên ra khỏi học kì.",{variant:"success"}),o.invalidateQueries({queryKey:["getAllStudent",h,g,s("limit"),s("page"),s("searchField"),s("keywords")]}))},onError(){e("Tạo sinh viên thất bại, thử lại",{variant:"error"})}})}},me=e=>{let r=["B","KB","MB","GB","TB","PB"],n=0;for(n;e>1024;n++)e/=1024;return e.toFixed(1)+" "+r[n]};var Te=(e=>(e.SESSION_HOST="SESSION_HOST",e.ADVISOR="ADVISOR",e.REVIEWER="REVIEWER",e))(Te||{});const Se=async e=>d.get(`/api/v1/evaluations/${e}`),xe=async(e,r)=>d.get(`/api/v1/evaluations?termId=${e}&type=${r}`),Be=async e=>d.post("api/v1/evaluations",e),fe=async(e,r)=>d.put(`api/v1/evaluations/${e}`,r),Ee=async e=>d.delete(`api/v1/evaluations/${e}`);var J=(e=>(e.getEvaluationByType="getEvaluationByType",e.getEvaluationById="getEvaluationById",e))(J||{});const Ve=()=>{const{enqueueSnackbar:e}=Q(),{lecturerStore:r}=D();return{handleGetEvalutationByType:(c,u)=>b(["getEvaluationByType",c,u],()=>xe(c,u),{staleTime:1e3}),handleUiRender:()=>{const c=r.currentRoleRender;var u=[];return c===F.HEAD_COURSE||c===F.HEAD_LECTURER?u.push("all"):u.push("readOnly"),u},handleGetEvaluationById:c=>b(["getEvaluationById",c],()=>Se(c),{enabled:!!c}),onUpdateEvaluationById:(c,u,v)=>S(I=>fe(v,I),{onSuccess(){e("Cập nhật tiêu chí đánh giá thành công",{variant:"success"}),o.invalidateQueries({queryKey:["getEvaluationByType",c,u]}),o.invalidateQueries({queryKey:["getEvaluationById",v]})},onError(){e("Cập nhật tiêu chí đánh giá thất bại",{variant:"error"})}}),onDeleteEvaluationById:(c,u,v)=>S(()=>Ee(v),{onSuccess(){e("Xóa tiêu chí đánh giá thành công",{variant:"success"}),o.invalidateQueries({queryKey:["getEvaluationByType",c,u]})},onError(){e("Xóa tiêu chí đánh giá thất bại",{variant:"error"})}}),onCreateEvaluation:(c,u)=>S(v=>Be(v),{onSuccess(){e("Tạo tiêu chí đánh giá thành công",{variant:"success"}),o.invalidateQueries({queryKey:["getEvaluationByType",c,u]})},onError(){e("Tạo tiêu chí đánh giá thất bại",{variant:"error"})}})}},je=async e=>d.get(`/api/v1/topics/${e}`),be=async(e,r,n)=>d.get(`/api/v1/topics/query?termId=${e}&keywords=${r}&searchField=${n}`),Ie=async e=>d.get(`/api/v1/topics?termId=${e}`),ke=async(e,r)=>d.put(`/api/v1/topics/quantity-group-max?termId=${e}`,{quantityGroupMax:r}),Ce=async(e,r)=>d.get(`/api/v1/topics?lecturerId=${e}&termId=${r}`),Ae=async(e,r)=>d.post(`/api/v1/topics?termId=${r}`,e),Re=async(e,r)=>d.put(`/api/v1/topics/${e}`,r),Le=async(e,r)=>d.put(`/api/v1/topics/${e}/status`,r),qe=async e=>d.delete(`/api/v1/topics/${e}`);var A=(e=>(e.create="create",e.update="update",e.getAll="getAll",e.getById="getById",e.delete="delete",e))(A||{});const w=(e,r)=>{let n="";switch(e){case"create":n="Tạo "+r+" thành công";break;case"update":n="Cập nhật "+r+" thành công";break;case"getAll":break;case"getById":break;case"delete":n="Xóa "+r+" thành công";break}return n};var $=(e=>(e.getAllTopicByTermMajor="getAllTopicByTermMajor",e.getAllTopic="getAllTopic",e.getSearchTopic="getSearchTopic",e.getTopicById="getTopicById",e.getAllTopicByLecturerTerm="getAllTopicByLecturerTerm",e))($||{});const ze=()=>{const{enqueueSnackbar:e}=Q(),r=z(i=>i.topicSlice),{termStore:n}=O(),{lecturerStore:l}=D(),{getQueryField:x}=W();return{topicStore:r,handleTopicsByTermByMajor:()=>b(["getSearchTopic",n.currentTerm.id,""],()=>Ie(n.currentTerm.id),{staleTime:1/0}),handleTopicsByLecturerByTerm:()=>b(["getAllTopicByLecturerTerm",l.me.user.id,n.currentTerm.id],()=>Ce(l.me.user.id,n.currentTerm.id),{staleTime:1/0,onSuccess(i){}}),handleUiRender:()=>{const i=l.currentRoleRender;var p=[];return i===F.HEAD_LECTURER?(p.push("all"),p.push("crud")):i===F.LECTURER?p.push("crud"):p.push("readOnly"),p},handleTopicById:i=>b(["getTopicById",i],()=>je(i)),onCreateTopicByToken:()=>S(i=>Ae(i,n.currentTerm.id),{onSuccess(){e(w(A.create,"Đề tài"),{variant:"success"}),o.invalidateQueries({queryKey:["getSearchTopic",n.currentTerm.id,""]}),o.invalidateQueries({queryKey:["getAllTopicByLecturerTerm",l.me.user.id,n.currentTerm.id]})},onError(){e("Tạo đề tài thất bại",{variant:"error"})}}),onUpdateTopicById:i=>S(p=>Re(i,p),{onSuccess(){e(w(A.update,"Đề tài"),{variant:"success"}),o.invalidateQueries({queryKey:["getSearchTopic",n.currentTerm.id,""]}),o.invalidateQueries({queryKey:["getAllTopicByLecturerTerm",l.me.user.id,n.currentTerm.id]}),o.invalidateQueries({queryKey:["getTopicById",i]}),o.invalidateQueries({queryKey:["getAllTopicByLecturerTerm",l.me.user.id,n.currentTerm.id]})},onError(){e("Cập nhật tài thất bại vui lòng thử lại sau",{variant:"error"})}}),onDeleteTopicById:()=>S(i=>qe(i),{onSuccess(){e(w(A.delete,"Đề tài"),{variant:"success"}),o.invalidateQueries({queryKey:["getSearchTopic",n.currentTerm.id,""]}),o.invalidateQueries({queryKey:["getAllTopicByLecturerTerm",l.me.user.id,n.currentTerm.id]})},onError(){e("Xóa đề tài thất bại vui lòng thử lại sau",{variant:"error"})}}),onUpdateAllQuantityGroupMax:()=>S(i=>ke(n.currentTerm.id,i),{onSuccess(){e(w(A.update,"Đề tài"),{variant:"success"}),o.invalidateQueries({queryKey:["getSearchTopic",n.currentTerm.id,""]})},onError(){e("Cập nhật đề tài thất bại vui lòng thử lại sau",{variant:"error"})}}),onUpdateStatusTopic:i=>S(p=>Le(i,p),{onSuccess(){e(w(A.update,"Đề tài"),{variant:"success"}),o.invalidateQueries({queryKey:["getSearchTopic",n.currentTerm.id,""]}),o.invalidateQueries({queryKey:["getTopicById",i]})},onError(){e("Cập nhật đề tài thất bại vui lòng thử lại sau",{variant:"error"})}}),handleSearchTopic:()=>b(["getSearchTopic",n.currentTerm.id,x("keywords")],()=>be(n.currentTerm.id,x("keywords"),"name"),{staleTime:1/0})}},we=["xlsx","xls","csv"];var Ue=(e=>(e.STUDENT="students",e.LECTURER="lecturers",e.TOPIC="topics",e.EVALUATION="evaluations",e))(Ue||{});const M=ee.create({headers:{"Content-Type":"multipart/form-data"}});M.interceptors.request.use(e=>{const r=H("accessToken");return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));M.interceptors.response.use(e=>e.data,async e=>{const r=e.config;if(e.response.data.status===401&&e.response.data.success===!1){r._retry=!0;try{const n=H("refreshToken"),l=await d.post("/api/v1/lecturers/refresh-token",{refreshToken:n});return localStorage.setItem("accessToken",JSON.stringify(l.accessToken)),r.headers.Authorization=`Bearer ${l.accessToken}`,d(r)}catch(n){return Promise.reject(n)}}return Promise.reject(e.response.data)});const Ke=e=>{const{entityUpload:r,termId:n,majorId:l,me:x,typeEvaluation:g,handleCloseUpload:h}=e,[s,c]=k.useState(!1),[u,v]=k.useState(!1),[I,E]=k.useState(""),[R,C]=k.useState(""),[i,p]=k.useState(),{enqueueSnackbar:a}=Q(),[y,U]=k.useState(0),P=j=>{const m=j.name.split("."),L=m[m.length-1];return we.includes(L)};return{importExcel:async j=>{const m=j.target.files[0];E(m.name),C(me(m.size));const L=new FileReader;v(!1),c(!0),m?(p(m),P(m)?L.readAsBinaryString(m):a("File tải lên không đúng định dạng Excel, CSV file",{variant:"error"})):a("Đã có lỗi khi tải lên, vui lòng thử lại sau...",{variant:"error"})},setFileName:E,setTotalSize:C,setCurrentFile:p,setValueLoading:U,savedFileToDatabase:async j=>{const m={file:j,termId:n,majorId:l},L={termId:n,file:j,type:g};return M.post(`${te.API_URL}/api/v1/${r}/import`,r!=="evaluations"?m:L,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:q=>{U(q.progress)}}).then(async function(q){q.success&&(r==="lecturers"&&(a("Lưu danh sách giảng viên từ excel file thành công",{variant:"success"}),o.invalidateQueries([ce.getAllLecturer,l,"10","1","username",""]),h()),r==="evaluations"&&(a("Lưu danh sách tiêu chí từ excel file thành công",{variant:"success"}),o.invalidateQueries({queryKey:[J.getEvaluationByType,n,g]}),h()),r==="students"&&(a("Lưu danh sách sinh viên từ excel file thành công",{variant:"success"}),o.invalidateQueries({queryKey:[X.getAllStudent,n,l,"10","1","",""]}),h()),r==="topics"&&(a("Lưu danh sách Đề tài từ excel file thành công",{variant:"success"}),o.invalidateQueries({queryKey:[$.getSearchTopic,n,""]}),o.invalidateQueries({queryKey:[$.getAllTopicByLecturerTerm,x.id,n]}),h()))}).catch(function(q){a(q.message,{variant:"error"})})},currentFile:i,success:u,loading:s,fileName:I,valueLoading:y,totalSize:R}};function Fe(e){return t.jsxs(T,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(T,{sx:{width:"100%",mr:1},children:t.jsx(ie,{variant:"determinate",...e})}),t.jsx(T,{sx:{minWidth:35},children:t.jsx(f,{variant:"body2",color:"text.secondary",children:`${Math.round(e.value)}%`})})]})}const Qe=re("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"100%",overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:"100%",backgroundColor:"red"});function _e(e){const{entityUpload:r,typeEvaluation:n,label:l="Tải dữ liệu lên từ Excel",labelToolTip:x="",disabled:g=!1}=e,{termStore:h}=O(),{majorStore:s}=_(),{lecturerStore:c}=D(),[u,v]=k.useState(!1),I=()=>{v(!0)},E=()=>{v(!1),R()},R=()=>{U(""),P(""),N(""),G(void 0)},{importExcel:C,valueLoading:i,totalSize:p,currentFile:a,savedFileToDatabase:y,setFileName:U,setTotalSize:P,setCurrentFile:G,setValueLoading:N,fileName:j}=Ke({entityUpload:r,termId:h.currentTerm.id,majorId:s.currentMajor.id,me:c.me.user,typeEvaluation:n,handleCloseUpload:E});return t.jsxs(T,{children:[t.jsx(ve,{arrow:!0,title:x,children:t.jsxs(K,{size:"small",disabled:g,onClick:I,variant:"contained",color:"primary",children:[t.jsx(B,{icon:"uiw:file-excel",style:{marginRight:2},width:20}),l]})}),t.jsx(oe,{maxWidth:"md",open:u,onClose:E,children:t.jsxs(V,{sx:{px:10,py:7},elevation:3,children:[t.jsx(T,{display:"flex",gap:4,children:t.jsx(ne,{mb:4,variant:"h4",textTransform:"uppercase",children:"Tải File Excel"})}),t.jsx(V,{elevation:1,sx:{px:10,py:12,mb:6},children:t.jsx(T,{sx:{border:2,borderColor:"primary.main",borderRadius:1},style:{borderStyle:"dashed"},children:a?t.jsxs(T,{height:300,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:[t.jsx(B,{color:"#40bb92",width:150,icon:"teenyicons:file-tick-solid"}),t.jsxs(f,{mt:6,variant:"h5",color:"success.dark",children:[t.jsx(B,{icon:"teenyicons:tick-circle-solid"})," Đã tải file lên thành công, Lưu dữ liệu xuống cơ sở dữ liệu."]}),t.jsxs(K,{color:"success",variant:"contained",disabled:a===void 0,onClick:()=>{y(a)},children:[t.jsx(B,{width:20,style:{marginRight:10},icon:"el:hand-right"}),"Lưu vào hệ thống"]})]}):t.jsxs(K,{component:"label",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",py:20},children:[t.jsx(Qe,{type:"file",onChange:m=>{C(m)}}),t.jsx(T,{bgcolor:"rgb(0,82,177,0.2)",p:10,borderRadius:"50%",width:100,height:100,children:t.jsx(B,{color:"rgb(0,82,177,0.7)",width:"full",height:"full",icon:"line-md:uploading-loop"})}),t.jsxs(f,{fontWeight:"600",textTransform:"uppercase",color:"grey.600",mt:6,variant:"h4",children:[t.jsx(B,{style:{marginRight:2},icon:"fxemoji:warningsign"}),"Chưa có file tải lên ngay"]})]})})}),t.jsx(T,{children:a!==void 0?t.jsxs(ae,{sx:{p:6,borderRadius:2,bgcolor:"rgb(0,82,177,0.1)"},children:[t.jsxs(T,{gap:6,alignItems:"center",display:"flex",children:[t.jsx(B,{width:50,icon:"vscode-icons:file-type-excel",color:"rgb(0,82,177,0.8)"}),t.jsxs(T,{width:320,children:[t.jsxs(f,{variant:"h6",color:"primary.dark",children:["tên file:"," ",t.jsx(f,{component:"span",variant:"h6",color:"grey.800",children:j})]}),t.jsxs(f,{variant:"h6",color:"primary.dark",children:["kích thước:"," ",t.jsx(f,{component:"span",variant:"h6",color:"grey.800",children:p})]})]}),t.jsx(T,{})]}),t.jsxs(f,{mt:8,variant:"body1",color:"initial",children:["Tiến độ lưu: ",i*100," %"]}),t.jsx(Fe,{value:i*100}),i===1&&t.jsxs(f,{textAlign:"end",variant:"h6",fontWeight:700,color:"success.main",children:["Lưu thành công",t.jsx(B,{icon:"mdi:tick-outline",width:18})]})]}):t.jsx(se,{})}),t.jsx(T,{mt:10,justifyContent:"end",gap:4,display:"flex",children:t.jsxs(K,{variant:"contained",color:"primary",onClick:E,children:[t.jsx(B,{icon:"mdi:close-outline"}),"Thoát"]})})]})})]})}export{_e as M,Ue as T,ze as a,Ve as b,Te as c,Ne as u};
