import{r as h,j as e,B as r,I as j,a as o,a5 as D,aB as F,E as M,T as I,ah as L,ai as H,P,R as W,aF as A}from"./index-wQ8JwfM2.js";import{T as B,a as R}from"./Table-cDawzk-H.js";import{u as N}from"./useQueryGroupStudent-U8YA793n.js";import{a as k}from"./index-k6g5FF0C.js";import"./KeyboardArrowRight-yT4WKBtg.js";import"./index-owcxqeif.js";import"./Stack-xq_Pr2sx.js";import"./apiStudent-mO15R6c8.js";function U(i){const{groupStudentId:s,groupStudentName:l,open:g,onClose:t}=i,{onDeleteGroupStudent:u}=N(),{mutate:b,isSuccess:c}=u(),p=()=>{b(s)};return h.useEffect(()=>{c&&t()},[c]),e.jsx(k,{onClose:t,open:g,children:e.jsxs(r,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",px:10,py:12,children:[e.jsxs(r,{borderRadius:"50%",padding:10,sx:{background:"rgba(255,49,111,0.2)"},children:[e.jsx(j,{color:"#b31d1d82",height:70,width:70,icon:"uiw:usergroup-delete"})," "]}),e.jsxs(o,{variant:"h3",mt:10,mb:14,children:["Bạn muốn giải tán ",l," này ?"]}),e.jsxs(r,{width:"100%",display:"flex",gap:6,marginTop:1,children:[e.jsxs(D,{onClick:t,sx:{width:"50%"},color:"primary",variant:"contained",children:[e.jsx(j,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(D,{type:"submit",sx:{width:"50%"},onClick:p,color:"error",variant:"contained",children:[e.jsx(j,{width:20,style:{marginRight:4},icon:"uiw:usergroup-delete"}),"Xóa nhóm"]})]})]})})}function K(i){const{rows:s,totalItems:l,totalPage:g,page:t,handleChangePage:u}=i,b=F(),[c,p]=h.useState({isOpen:!1,groupStudentId:"",groupStudentName:""}),T=(a,C)=>{p({groupStudentId:a,groupStudentName:C,isOpen:!0})},d=()=>{p(a=>({...a,isOpen:!1}))},m=[{headerName:"Tên nhóm",field:"name",flex:1,align:"left",headerAlign:"center"},{headerName:"Tên Đề tài",field:"name6",flex:3,headerAlign:"center",renderCell:a=>e.jsx(o,{children:a.row.topicName?a.row.topicName:"Chưa có đề tài"})},{headerName:"GV hướng dẫn",field:"name3",flex:1,align:"left",headerAlign:"center",renderCell:a=>e.jsx(o,{children:a.row.lecturerName?a.row.lecturerName:"Chưa có giảng viên HD"})},{headerName:"Số lượng thành viên",field:"name4",flex:1,align:"center",headerAlign:"center",renderCell:a=>e.jsxs(o,{children:[a.row.numOfMembers,"/2"]})},{headerName:"Chức năng",field:"name8",flex:.5,align:"center",headerAlign:"center",renderCell:a=>e.jsxs(r,{display:"flex",gap:6,children:[e.jsx(R,{title:"Chi tiết",children:e.jsx(M,{color:"primary",onClick:()=>b(`/group-students/detail/${a.row.id}`),children:e.jsx(j,{icon:"clarity:file-group-line",style:{color:"#0288d1"}})})}),e.jsx(R,{title:"Xóa nhóm",children:e.jsx(M,{color:"primary",onClick:()=>T(a.row.id,a.row.name),children:e.jsx(j,{icon:"carbon:close-filled",style:{color:" #f2365b"}})})})]})}],{onImportGroupStudent:v}=N(),{mutate:y}=v(),w=()=>{y()};return e.jsxs(r,{children:[e.jsx(B,{rows:s,sx:{bgcolor:"white"},columns:m,totalItems:l,totalPages:g,page:t,handleChangePage:u,noData:e.jsxs(D,{variant:"contained",onClick:w,children:["Tạo danh sách nhóm sinh viên"," "]}),disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0}),e.jsx(U,{groupStudentId:c.groupStudentId,groupStudentName:c.groupStudentName,open:c.isOpen,onClose:d})]})}const X=i=>{if(!i)return[];const s=[];return i.map(l=>{s.push({...l,mssv:l.username,group:"NO_GROUP"})}),s};function Y(i){const{nameGroup:s,handleSetData:l}=i,g=s,[t,u]=h.useState(),{handleGetStudentNoHaveGroup:b}=N(),{data:c,isLoading:p,isFetching:T,isSuccess:d}=b(),m=n=>{n.currentTarget.classList.add("dragged"),n.dataTransfer.setData("text/plain",n.currentTarget.id),n.dataTransfer.effectAllowed="move"},v=n=>{n.currentTarget.classList.remove("dragged")},y=n=>{n.preventDefault(),n.currentTarget.classList.add("dragged-over"),n.dataTransfer.dropEffect="move"},w=n=>{let x=n.currentTarget,f=n.relatedTarget;if(f.parentNode===x||f===x)return;n.preventDefault(),n.currentTarget.classList.remove("dragged-over")},a=n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},C=(n,x,f)=>{n.preventDefault(),n.currentTarget.classList.remove("dragged-over");let G=n.dataTransfer.getData("text/plain"),_=t==null?void 0:t.map(E=>(E.mssv.toString()===G.toString()&&(E.group=f),E));u(_)},S=t==null?void 0:t.filter(n=>n.group===s),O=t==null?void 0:t.filter(n=>n.group==="NO_GROUP");return h.useEffect(()=>{d&&u(X(c==null?void 0:c.students))},[p,T]),h.useEffect(()=>{l(t==null?void 0:t.filter(n=>n.group===s))},[t]),e.jsx(r,{position:"relative",sx:{bgcolor:"white",py:4,px:8,borderRadius:4},children:e.jsxs(r,{className:"container",width:"full",display:"flex",gap:10,children:[e.jsxs(r,{flex:1,children:[e.jsxs(r,{alignItems:"center",gap:4,display:"flex",children:[e.jsx(o,{variant:"h5",fontWeight:"500",color:"primary.main",children:"Danh sách sinh viên"}),e.jsxs(D,{color:"success",children:[e.jsx(j,{width:20,icon:"fluent:filter-12-filled"}),"Filter"]})]}),e.jsx(r,{onDragLeave:n=>w(n),onDragEnter:n=>y(n),onDragEnd:n=>v(n),onDragOver:n=>a(n),onDrop:n=>C(n,!1,"NO_GROUP"),pr:10,sx:{maxHeight:400,overflowY:"auto","&::-webkit-scrollbar":{width:4},".MuiPaper-root":{pl:8,pr:8,py:0},"&::-webkit-scrollbar-thumb":{borderRadius:10,width:20,bgcolor:"grey.400",color:"grey.400"}},children:e.jsx(r,{className:"drag_container",children:e.jsx(r,{className:"container",children:e.jsx(r,{className:"drag_column",children:e.jsx(r,{className:"drag_row",children:O==null?void 0:O.map((n,x)=>e.jsx(r,{sx:{bgcolor:"grey.100",borderRadius:1,px:6,py:4,color:"white",my:4,border:"2px solid #fefefe",cursor:"pointer",":hover":{border:"2px solid #00B1A2",boxShadow:" rgba(0, 0, 0, 0.25) 0px 25px 50px -12px;",transition:"0.1s ease-in",backgroundColor:"#D3FFEF"}},id:n.mssv,draggable:!0,onDragStart:f=>m(f),onDragEnd:f=>m(f),onDrop:f=>C(f,!1,s),children:e.jsx(r,{gap:10,position:"relative",alignItems:"center",display:"flex",children:e.jsxs(r,{children:[e.jsx(o,{position:"absolute",right:10,top:2,bgcolor:"success.main",px:4,py:2,borderRadius:1,variant:"body2",color:"white",children:"Chưa có nhóm"}),e.jsxs(o,{variant:"h6",color:"primary.main",fontWeight:"500",children:[e.jsxs("span",{children:[" Họ và tên: ","   "]}),n.fullName]}),e.jsxs(o,{variant:"body2",color:"primary.dark",fontWeight:"500",children:[e.jsxs("span",{children:["Mã sinh vien: ","  "]})," ",n.mssv]})]})})},n.mssv))})})})})})]}),e.jsxs(r,{mt:20,flex:1,children:[e.jsx(r,{justifyContent:"space-between",display:"flex",mb:10,children:e.jsxs(o,{variant:"h4",fontWeight:"500",color:"error.main",children:["Nhóm sinh viên ",s]})}),e.jsx(r,{sx:{overflowY:"auto","&::-webkit-scrollbar":{width:4},".MuiPaper-root":{pl:8,pr:8,py:0},"&::-webkit-scrollbar-thumb":{borderRadius:10,width:20,bgcolor:"grey.400",color:"grey.400"},height:200},flex:1,onDragLeave:n=>w(n),onDragEnter:n=>y(n),onDragEnd:n=>v(n),onDragOver:n=>a(n),onDrop:n=>C(n,!1,s),children:e.jsx(r,{className:"drag_container",children:e.jsx(r,{className:"container",children:e.jsx(r,{className:"drag_column",children:e.jsx(r,{className:"drag_row",children:S==null?void 0:S.map(n=>e.jsx(r,{sx:{bgcolor:"grey.100",borderRadius:1,px:6,py:4,color:"white",my:4,border:"2px solid #fefefe",cursor:"pointer",":hover":{border:"2px solid #b11500",boxShadow:"1px 1px 1px 1px #E6E6E6",transition:"0.1s ease-in",backgroundColor:"#ffd5d3"}},id:n.mssv,draggable:!0,onDragStart:x=>m(x),onDragEnd:x=>m(x),children:e.jsx(r,{gap:10,position:"relative",alignItems:"center",display:"flex",children:e.jsxs(r,{children:[e.jsxs(o,{position:"absolute",right:10,top:2,bgcolor:"error.main",px:4,py:2,borderRadius:2,variant:"body2",color:"white",children:["Nhóm ",g]}),e.jsxs(o,{variant:"h6",color:"error.main",fontWeight:"500",children:[e.jsxs("span",{children:[" Họ và tên: ","   "]}),n.fullName]}),e.jsxs(o,{variant:"body2",color:"error.dark",fontWeight:"500",children:[e.jsxs("span",{children:["Mã sinh vien: ","  "]})," ",n.mssv]})]})})},n.mssv))})})})})}),e.jsxs(r,{mb:6,mt:14,pt:10,width:"full",justifyItems:"space-between",display:"flex",borderTop:"1px solid #56bae8",children:[e.jsxs(o,{flex:1,variant:"h6",color:"primary.main",fontWeight:"500",children:["Số lượng : ","      ",e.jsxs("span",{style:{color:"black"},children:[" ",S==null?void 0:S.length," / 2"]})]}),S&&S.length>2&&e.jsxs(o,{variant:"body1",color:"warning.dark",children:[e.jsx(j,{icon:"twemoji:warning"}),"Nhóm sinh viên tối đa 2 thành viên"]})]})]})]})})}function $(i){const{onClose:s,open:l}=i,{handleGetCountOfGroupStudent:g,onCreateGroupStudent:t}=N(),{data:u,isFetching:b,isLoading:c,isSuccess:p}=g(),{mutate:T,isSuccess:d}=t(),[m,v]=h.useState([]),y=a=>{v(a)},w=()=>{const a=m.map(C=>C.studentId);T(a)};return h.useEffect(()=>{d&&s()},[d]),e.jsx(k,{maxWidth:"xl",open:l,onClose:s,children:e.jsxs(r,{p:10,children:[e.jsx(I,{mb:10,variant:"h4",textTransform:"uppercase",children:"Tạo Nhóm sinh viên mới"}),c||b?e.jsx(L,{}):e.jsxs(e.Fragment,{children:[e.jsx(r,{children:e.jsx(H,{label:"Tên nhóm sinh viên",disabled:!0,value:p?u.nameCount:""})}),e.jsxs(P,{elevation:1,sx:{mt:10,p:10},children:[e.jsx(Y,{handleSetData:y,nameGroup:p?u.nameCount:""}),e.jsx(o,{mt:4,variant:"body1",color:"error",children:"**Chú thích: Kéo thả sinh viên trong danh sách sinh viên sang nhóm mới để thêm sinh viên vào nhóm."})]})]}),e.jsxs(r,{mt:10,justifyContent:"end",gap:4,display:"flex",children:[e.jsxs(D,{variant:"contained",color:"primary",onClick:s,children:[e.jsx(j,{icon:"mdi:close-outline"}),"Hủy"]}),e.jsxs(D,{onClick:w,variant:"contained",color:"success",children:[e.jsx(j,{icon:"material-symbols:save-outline"}),"Lưu thông tin"]})]})]})})}function q(){const[i,s]=h.useState(!1),l=()=>{s(!1)},g=()=>{s(!0)};return e.jsxs(r,{mb:4,display:"flex",justifyContent:"end",flexWrap:"wrap",gap:2,children:[e.jsxs(D,{size:"small",onClick:g,color:"error",type:"button",variant:"contained",children:[e.jsx(j,{icon:"lets-icons:add-round",width:20}),"Tạo nhóm sinh viên"]}),e.jsx($,{open:i,onClose:l})]})}const z=W.memo(q);function se(){const{handleManagerRenderActionGroupStudent:i,params:s}=N(),[l,g]=h.useState(10),[t,u]=h.useState(s.page),[b,c]=h.useState(""),[p,T]=h.useState(A.ALL),{data:d,isLoading:m,isFetching:v}=i(l,t,p,b),y=w=>{u(w)};return e.jsxs(P,{sx:{py:10,px:10},elevation:1,children:[e.jsx(r,{display:"flex",justifyContent:"space-between",children:e.jsx(I,{icon:"quill:list",mb:8,mt:2,children:"Danh sách nhóm sinh viên"})}),e.jsx(z,{}),m||v?e.jsx(L,{}):e.jsx(K,{totalPage:s.totalPage,totalItems:d==null?void 0:d.groupStudents.length,handleChangePage:y,page:t,rows:d?d.groupStudents:[]})]})}export{se as default};
