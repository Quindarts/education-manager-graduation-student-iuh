import{x as te,y as _,al as G,aj as B,r as S,j as e,B as t,T as U,af as ie,ag as K,aa as ae,ai as T,ak as z,am as Y,a5 as g,I as u,a as k,ad as W,R as Q,E as q,Z as se,P as le,ah as oe,an as re}from"./index-NapbxlsL.js";import{T as de,a as V}from"./Table-WHKjjRLK.js";import{a as $}from"./index-qC6u9U62.js";import{u as R,M as X,T as Z}from"./index-jCkRbMnd.js";import{c as ce}from"./person.validation-jxi8KQi5.js";import{G as he,a as ue,b as me}from"./GridToolbarDensitySelector-SFez8wTk.js";import{u as J}from"./useParams-vd7i9Ic6.js";import"./KeyboardArrowRight-5D6Ejjzb.js";import"./index-UQJd2y-u.js";import"./Stack-ScuxqrBn.js";import"./useQueryLecturer-I1hzz5cM.js";import"./useQueryGroupLecturer-YqNk0Zqv.js";import"./apiStudent-jSxWDoLW.js";const ee=te().shape({username:_().matches(/^\d{6,}$/,"Mã số sinh viên phải chỉ gồm chữ số và lớn hơn 6 ký tự").required("Mã số sinh viên không được để trống"),fullName:_().matches(/^[a-zA-ZàáãạảăắằẳẵặâấầẩẫậèéẹẻẽêềếểễệđìíĩỉịòóõọỏôốồổỗộơớờởỡợùúũụủưứừửữựỳỵỷỹýÀÁÃẠẢĂẮẰẲẴẶÂẤẦẨẪẬÈÉẸẺẼÊỀẾỂỄỆĐÌÍĨỈỊÒÓÕỌỎÔỐỒỔỖỘƠỚỜỞỠỢÙÚŨỤỦƯỨỪỬỮỰỲỴỶỸÝ\s]+$/,"Họ và tên chỉ bao gồm chữ cái in hoa và in thường.").required("Họ và tên không được để trống"),phone:_().matches(/^0\d{9}$/,"Số điện thoại phải bắt đầu bằng số 0 và gồm 10 chữ số").required("Số điện thoại không được để trống"),email:_().email("Email phải hợp lệ").required("Email không được để trống")}),pe=[{_id:G.FEMALE,name:"Nữ"},{_id:G.MALE,name:"Nam"}],xe=[{_id:"UNIVERSITY",name:"Đại học"},{_id:"COLLEGE",name:"Cao đẳng"}];function ge(m){var y,N,b,v,D,L,O,A;const{onClose:a,open:r,studentId:h}=m,{handleGetStudentById:s,onUpdateStudent:l}=R(),{data:n,isLoading:p,isFetched:C}=s(h),{majorStore:d}=B(),{mutate:o,isSuccess:c}=l(h),M=j=>{o(j)};return S.useEffect(()=>{c&&a()},[c]),e.jsx($,{maxWidth:"xs",open:r,onClose:a,children:e.jsxs(t,{p:10,children:[e.jsx(U,{mb:10,variant:"h4",textTransform:"uppercase",children:"Cập nhật thông tin Sinh viên"}),p&&!C?e.jsx(t,{m:"auto",height:500,children:e.jsx(ie,{})}):e.jsx(K,{validationSchema:ee,initialValues:{username:`${(y=n==null?void 0:n.student)==null?void 0:y.username}`,fullName:`${(N=n==null?void 0:n.student)==null?void 0:N.fullName}`,email:`${(b=n==null?void 0:n.student)==null?void 0:b.email}`,phone:`${(v=n==null?void 0:n.student)==null?void 0:v.phone}`,dateOfBirth:n!=null&&n.student.dateOfBirth?ae(n==null?void 0:n.student.dateOfBirth):null,clazzName:`${(D=n==null?void 0:n.student)==null?void 0:D.clazzName}`,gender:`${(L=n==null?void 0:n.student)==null?void 0:L.gender}`,majorId:`${(O=n==null?void 0:n.student)==null?void 0:O.majorId}`,typeTraining:`${(A=n==null?void 0:n.student)==null?void 0:A.typeTraining}`},onSubmit:j=>M(j),children:({values:j,errors:x,touched:f,handleSubmit:H,handleChange:E,handleBlur:I,setFieldValue:P})=>e.jsxs("form",{onSubmit:H,children:[e.jsx(T,{label:"Mã sinh viên",name:"username",required:!0,value:j.username,placeholder:"Ví dụ: 20189141",disabled:!0,onChange:E,onBlur:I,error:!!(x.username&&f.username),helperText:`${x.username&&f.username?x.username:""}`}),e.jsx(T,{value:j.fullName,name:"fullName",label:"Họ và tên",required:!0,onChange:E,onBlur:I,placeholder:"Họ và tên",error:!!(x.fullName&&f.fullName),helperText:`${x.fullName&&f.fullName?x.fullName:""}`}),e.jsxs(t,{display:"flex",gap:8,alignContent:"center",children:[e.jsx(t,{width:"50%",children:e.jsx(z,{sx:{mb:8},label:"Giới tính",value:`${j.gender}`,onChange:w=>{P("gender",w.target.value)},options:pe})}),e.jsx(T,{value:j.clazzName,name:"clazzName",label:"Lớp danh nghĩa",required:!0,onChange:E,onBlur:I,placeholder:"Ví dụ: DHKTPM17C",error:!!(x.clazzName&&f.clazzName),helperText:`${x.clazzName&&f.clazzName?x.clazzName:""}`})]}),e.jsx(T,{value:j.email,name:"email",label:"Email",required:!0,placeholder:"Nhập vào email",onChange:E,onBlur:I,error:!!(x.email&&f.email),helperText:`${x.email&&f.email?x.email:""}`}),e.jsx(T,{name:"phone",value:j.phone,label:"Số điện thoại",required:!0,placeholder:"Nhập vào số điện thoại",onChange:E,onBlur:I,error:!!(x.phone&&f.phone),helperText:`${x.phone&&f.phone?x.phone:""}`}),e.jsx(t,{sx:{mb:8},children:e.jsx(z,{label:"Chuyên ngành",value:j.majorId,onChange:w=>{P("majorId",w.target.value)},options:Y(d.allMajor),placeholder:"Chuyên ngành"})}),e.jsx(z,{label:"Loại đào tạo",value:`${j.typeTraining}`,onChange:w=>{P("typeTraning",w.target.value)},options:xe}),e.jsxs(t,{mt:10,justifyContent:"end",gap:4,display:"flex",children:[e.jsxs(g,{variant:"contained",color:"primary",onClick:a,children:[e.jsx(u,{icon:"mdi:close-outline"}),"Hủy"]}),e.jsxs(g,{variant:"contained",color:"success",type:"submit",children:[e.jsx(u,{icon:"material-symbols:save-outline"}),"Lưu thông tin"]})]})]})})]})})}function je(m){const{onClose:a,open:r,studentId:h,status:s}=m,{onLockOnlyStudent:l}=R(),{mutate:n,isSuccess:p}=l(h),C=()=>{n(s)};return S.useEffect(()=>{a()},[p]),e.jsx($,{open:r,onClose:a,children:e.jsxs(t,{m:10,children:[e.jsx(k,{mb:4,fontWeight:600,variant:"h3",children:s?"Đóng tài khoản Sinh viên ?":"Mở tài khoản Sinh viên ?"}),e.jsxs(t,{mt:12,sx:{display:"flex",gap:3},children:[e.jsxs(g,{onClick:a,sx:{width:"50%"},variant:"contained",color:"primary",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(g,{type:"submit",sx:{width:"50%"},variant:"contained",color:s?"error":"success",onClick:C,children:[e.jsx(u,{width:20,style:{marginRight:4},icon:s?"material-symbols:lock-outline":"bi:unlock"}),s?"Đóng tài khoản ":"Mở tài khoản "]})]})]})})}function fe(m){const{onClose:a,open:r,studentId:h}=m,{onDeleteStudent:s}=R(),{mutate:l,isSuccess:n}=s(),p=()=>{l(h)};return S.useEffect(()=>{n&&a()},[n]),e.jsx($,{onClose:a,open:r,children:e.jsxs(t,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",px:10,py:12,children:[e.jsxs(t,{borderRadius:"50%",padding:3,sx:{background:"rgba(255,49,111,0.2)"},children:[e.jsx(u,{color:"#b31d1d82",height:70,width:70,icon:"fa-solid:trash-restore"})," "]}),e.jsx(k,{variant:"h3",mt:10,mb:14,children:"Bạn có chắc chắn muốn xóa sinh viên này ?"}),e.jsxs(t,{width:"100%",display:"flex",gap:6,marginTop:1,children:[e.jsxs(g,{onClick:a,sx:{width:"50%"},color:"primary",variant:"contained",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(g,{type:"submit",onClick:p,sx:{width:"50%"},color:"error",variant:"contained",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"material-symbols:auto-delete-outline"}),"Xóa sinh viên"]})]})]})})}function Se(m){const{onClose:a,open:r,studentId:h}=m,{onResetPassword:s}=R(),{mutate:l,isSuccess:n}=s(),p=()=>{l(h)};return S.useEffect(()=>{n&&a()},[n]),e.jsx($,{open:r,onClose:a,children:e.jsxs(t,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",px:10,py:12,children:[e.jsxs(t,{borderRadius:"50%",padding:10,sx:{background:"rgba(49, 155, 255, 0.2)"},children:[e.jsx(u,{color:"#094f7482",height:70,width:70,icon:"teenyicons:key-outline"})," "]}),e.jsx(k,{variant:"h3",mt:10,mb:14,children:"Cấp lại mật khẩu cho sinh viên này?"}),e.jsxs(t,{width:"100%",display:"flex",gap:6,marginTop:1,children:[e.jsxs(g,{onClick:a,sx:{width:"50%"},color:"primary",variant:"contained",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(g,{type:"submit",onClick:p,sx:{width:"50%"},color:"success",variant:"contained",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"teenyicons:key-outline"}),"Cấp lại mật khẩu"]})]})]})})}function ye(m){const{listStudent:a,rows:r,open:h,onClose:s}=m;return e.jsx($,{open:h,onClose:s,children:e.jsxs(t,{m:10,children:[e.jsx(U,{mb:10,fontWeight:600,variant:"h3",children:"Khóa hoặc mở khóa toàn bộ Sinh viên đã chọn ?"}),e.jsx(t,{children:r.filter(l=>a.includes(l.id)).map(l=>e.jsx(t,{sx:{px:6,py:4,bgcolor:"grey.200",borderRadius:4,my:4},children:e.jsxs(k,{variant:"body1",color:"initial",children:[l.fullName," ","- - ","mssv: ",l.username]})}))}),e.jsxs(t,{mt:12,sx:{display:"flex",gap:3},children:[e.jsxs(g,{onClick:s,sx:{width:"50%"},variant:"contained",color:"primary",children:[e.jsx(u,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(g,{type:"submit",sx:{width:"70%"},variant:"contained",color:"success",children:[e.jsx(u,{width:20,style:{marginRight:2},icon:"dashicons:update-alt"}),"Khóa ( hoặc mở khóa) sinh viên này"]})]})]})})}function Ce(){return e.jsxs(he,{children:[e.jsx(ue,{sx:{px:2,py:1}}),e.jsx(me,{sx:{px:2,py:1}})]})}function be(m){const{rows:a,totalItems:r,totalPage:h,page:s,handleChangePage:l}=m,[n,p]=S.useState({studentId:"",isOpen:!1}),{termStore:C}=W(),d=()=>{p({...n,isOpen:!1})},o=i=>{p({studentId:i,isOpen:!0})},[c,M]=S.useState({studentId:"",status:!0,isOpen:!1}),y=()=>{M({...c,isOpen:!1})},N=(i,F)=>{M({studentId:i,status:F,isOpen:!0})},[b,v]=S.useState({studentId:"",username:"",isOpen:!1}),D=()=>{v({...b,isOpen:!1})},L=(i,F)=>{v({studentId:i,username:F,isOpen:!0})},[O,A]=S.useState({studentId:"",isOpen:!1}),j=()=>{A({...O,isOpen:!1})},x=i=>{A({studentId:i,isOpen:!0})},[f,H]=S.useState({listStudent:[],isOpen:!1}),E=()=>{H({...f,isOpen:!1})},I=i=>{H({listStudent:i,isOpen:!0})},P=[{headerName:"MSSV",field:"username",flex:.6,headerAlign:"center",align:"center",renderCell(i){return e.jsx(k,{variant:"body1",fontWeight:600,children:i.row.username})}},{headerName:"Họ & Tên đệm",field:"firstName",flex:.7,headerAlign:"center",align:"left",renderCell(i){return e.jsx(k,{variant:"body1",color:"initial",children:i.row.fullName.trim().split(" ").slice(0,-1).join(" ")})}},{headerName:"Tên",field:"lastName",flex:.5,headerAlign:"center",align:"left",renderCell(i){return e.jsx(k,{variant:"body1",color:"initial",children:i.row.fullName.trim().split(" ").pop()})}},{headerName:"Email",field:"email",flex:1,align:"left",headerAlign:"center"},{headerName:"Giới tính",field:"gender",flex:.5,align:"left",headerAlign:"center",renderCell:i=>e.jsx(k,{variant:"body1",children:ce(i.row.gender)})},{headerName:"Lớp danh nghĩa",field:"clazzName",flex:.7,align:"left",headerAlign:"center"},{headerName:"Trạng thái",field:"isActive",flex:.7,headerAlign:"center",align:"center",renderCell:i=>e.jsx(t,{children:e.jsxs(g,{variant:"contained",sx:{py:0,fontSize:12},onClick:()=>N(i.row.id,i.row.isActive),color:i.row.isActive?"success":"error",children:[" ",e.jsx(u,{width:20,icon:i.row.isActive?"bi:unlock":"material-symbols:lock-outline"}),i.row.isActive?"Đang mở":"Bị khóa"]})})},{headerName:"Chức năng",field:"name8",flex:.6,align:"center",headerAlign:"center",renderCell:i=>e.jsxs(t,{display:"flex",gap:2,children:[e.jsx(V,{title:"Cập nhật thông tin",children:e.jsx(q,{size:"small",onClick:()=>o(i.row.id),children:e.jsx(u,{icon:"emojione:pencil"})})}),e.jsx(t,{}),e.jsx(V,{title:"Cấp lại mật khẩu",children:e.jsx(q,{color:"primary",size:"small",onClick:()=>L(i.row.id,i.row.username),children:e.jsx(u,{width:20,icon:"wpf:password1"})})}),e.jsx(V,{title:"Xóa sinh viên",children:e.jsx(q,{color:"error",size:"small",onClick:()=>x(i.row.id),children:e.jsx(u,{icon:"mdi:trash"})})})]})}],[w,ne]=Q.useState([]);return e.jsxs(e.Fragment,{children:[e.jsxs(t,{children:[w.length>0&&e.jsx(t,{width:"100%",display:"flex",justifyContent:"end",children:e.jsxs(g,{color:"primary",variant:"contained",onClick:()=>I(w),children:[e.jsx(u,{icon:"ri:lock-2-line",width:20}),"Đã chọn ",w.length," Sinh viên"]})}),e.jsx(de,{rows:a,sx:{bgcolor:"white"},columns:P,totalItems:r,totalPages:h,page:s,handleChangePage:l,disableColumnMenu:!0,disableColumnFilter:!0,checkboxSelection:!0,slots:{toolbar:Ce},onRowSelectionModelChange:i=>{ne(i)},rowSelectionModel:w,noData:e.jsx(X,{entityUpload:Z.STUDENT,termId:C.currentTerm.id})})]}),e.jsx(Se,{studentId:b.studentId,open:b.isOpen,onClose:D,username:b.username}),e.jsx(ge,{studentId:n.studentId,open:n.isOpen,onClose:d}),e.jsx(je,{status:c.status,open:c.isOpen,onClose:y,studentId:c.studentId}),e.jsx(fe,{open:O.isOpen,onClose:j,studentId:O.studentId}),e.jsx(ye,{open:f.isOpen,onClose:E,rows:a,listStudent:f.listStudent})]})}const ve=[{_id:G.FEMALE,name:"Nữ"},{_id:G.MALE,name:"Nam"}],Ne=[{_id:"UNIVERSITY",name:"Đại học"},{_id:"COLLEGE",name:"Cao đẳng"}];function we(m){const{onClose:a,open:r}=m,{onCreateStudent:h}=R(),{termStore:s}=W(),{majorStore:l}=B(),{mutate:n,isSuccess:p}=h(),C=d=>{n(d)};return S.useEffect(()=>{p&&a()},[p]),e.jsx($,{maxWidth:"xs",open:r,onClose:a,children:e.jsxs(t,{p:10,children:[e.jsx(U,{mb:10,variant:"h4",textTransform:"uppercase",children:"Tạo Sinh viên"}),e.jsx(K,{validationSchema:ee,initialValues:{username:"",fullName:"",email:"",phone:"",clazzName:"DH",gender:"",majorId:`${l.currentMajor.id}`,typeTraining:"UNIVERSITY",termId:`${s.currentTerm.id}`},onSubmit:d=>C(d),children:({values:d,errors:o,touched:c,handleSubmit:M,handleChange:y,handleBlur:N,setFieldValue:b})=>e.jsxs("form",{onSubmit:M,children:[e.jsx(T,{label:"Mã sinh viên",name:"username",value:d.username,placeholder:"Ví dụ: 21089141",onChange:y,onBlur:N,error:!!(o.username&&c.username),helperText:`${o.username&&c.username?o.username:""}`}),e.jsx(T,{value:d.fullName,name:"fullName",label:"Họ và tên",onChange:y,onBlur:N,placeholder:"Họ và tên",error:!!(o.fullName&&c.fullName),helperText:`${o.fullName&&c.fullName?o.fullName:""}`}),e.jsxs(t,{display:"flex",gap:8,alignContent:"center",children:[e.jsx(t,{width:"50%",children:e.jsx(z,{sx:{mb:8},label:"Giới tính",value:`${d.gender?d.gender:""}`,onChange:v=>{b("gender",v.target.value)},options:ve})}),e.jsx(T,{value:d.clazzName,name:"clazzName",label:"Lớp danh nghĩa",onChange:y,onBlur:N,placeholder:"Ví dụ: DHKTPM17C",error:!!(o.clazzName&&c.clazzName),helperText:`${o.clazzName&&c.fullName?o.clazzName:""}`})]}),e.jsx(T,{value:d.email,name:"email",label:"Email",placeholder:"Nhập vào email",onChange:y,onBlur:N,error:!!(o.email&&c.email),helperText:`${o.email&&c.email?o.email:""}`}),e.jsx(T,{name:"phone",value:d.phone,label:"Số điện thoại",placeholder:"Nhập vào số điện thoại",onChange:y,onBlur:N,error:!!(o.phone&&c.phone),helperText:`${o.phone&&c.phone?o.phone:""}`}),e.jsx(t,{sx:{mb:8},children:e.jsx(z,{label:"Chuyên ngành",disabled:!0,value:`${d.majorId}`,onChange:v=>{b("majorId",v.target.value)},options:Y(l.allMajor),placeholder:"Chuyên ngành"})}),e.jsx(z,{label:"Loại đào tạo",value:`${d.typeTraining}`,onChange:v=>{b("typeTraining",v.target.value)},options:Ne}),e.jsxs(t,{mt:10,justifyContent:"end",gap:4,display:"flex",children:[e.jsxs(g,{variant:"contained",color:"primary",onClick:a,children:[e.jsx(u,{icon:"mdi:close-outline"}),"Hủy"]}),e.jsxs(g,{variant:"contained",color:"success",type:"submit",children:[e.jsx(u,{icon:"material-symbols:save-outline"}),"Lưu thông tin"]})]})]})})]})})}const Te=[{_id:"full_name",name:"Tên Sinh viên"},{_id:"username",name:"Mã Sinh viên"},{_id:"phone",name:"Số điện thoại"},{_id:"email",name:"Email"}];function Me(){W();const{majorStore:m}=B(),[a,r]=S.useState(!1),h=()=>{r(!1)},s=()=>{r(!0)},{onSearchChange:l,getQueryField:n,onTypeSearchChange:p,handleFocused:C}=J();return e.jsxs(e.Fragment,{children:[e.jsxs(t,{mb:4,display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(t,{flex:1,display:"flex",gap:2,width:"full",children:[e.jsx(t,{width:200,children:e.jsx(z,{placeholder:"Tìm kiếm theo",value:n("searchField")?n("searchField"):"username",onChange:d=>p(`${d.target.value}`),options:Te})}),e.jsx(se,{fullWidth:!0,size:"small",defaultValue:n("keywords"),onChange:l,onBlur:()=>C(!1),placeholder:"Tim kiếm sinh viên theo.."})]}),e.jsxs(g,{size:"small",onClick:s,color:"error",type:"button",variant:"contained",children:[e.jsx(u,{icon:"lets-icons:add-round",width:20}),"Tạo sinh viên"]}),e.jsx(X,{entityUpload:Z.STUDENT,majorId:m.currentMajor.id})]}),e.jsx(we,{open:a,onClose:h})]})}const ke=Q.memo(Me);function Be(){const{handleGetAllStudent:m,paramTotalPage:a}=R(),{majorStore:r}=B(),[h,s]=S.useState(1),{data:l,isLoading:n,isFetching:p,refetch:C}=m(),d=y=>{s(y)},{setLimit:o,setPage:c,getQueryField:M}=J();return S.useEffect(()=>{o(10),c(h)},[h]),S.useEffect(()=>{o(10),c(1),M("keywords")===""&&C()},[M("keywords")]),e.jsxs(le,{sx:{py:10,px:10},elevation:1,children:[e.jsxs(U,{icon:"quill:list",mb:8,mt:2,children:["Danh sách sinh viên ",r!=null&&r.currentMajor?r.currentMajor.name:""]}),e.jsx(ke,{}),n||p?e.jsx(oe,{}):e.jsx(e.Fragment,{children:e.jsx(be,{totalPage:a,totalItems:l.students.length,rows:re(l.students),handleChangePage:d,page:h})})]})}export{Be as default};
