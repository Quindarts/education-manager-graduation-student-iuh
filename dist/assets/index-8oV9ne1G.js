import{r as h,j as e,B as r,I as j,a as o,a5 as C,aB as _,E as M,T as k,ah as I,ai as W,P as L,R as H,ak as A,Z as B,aF as U}from"./index-NapbxlsL.js";import{T as z,a as R}from"./Table-WHKjjRLK.js";import{u as N}from"./useQueryGroupStudent-K9OoJogq.js";import{a as P}from"./index-qC6u9U62.js";import"./KeyboardArrowRight-5D6Ejjzb.js";import"./index-UQJd2y-u.js";import"./Stack-ScuxqrBn.js";import"./apiStudent-jSxWDoLW.js";function K(i){const{groupStudentId:s,groupStudentName:l,open:g,onClose:t}=i,{onDeleteGroupStudent:u}=N(),{mutate:b,isSuccess:d}=u(),p=()=>{b(s)};return h.useEffect(()=>{d&&t()},[d]),e.jsx(P,{onClose:t,open:g,children:e.jsxs(r,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",px:10,py:12,children:[e.jsxs(r,{borderRadius:"50%",padding:10,sx:{background:"rgba(255,49,111,0.2)"},children:[e.jsx(j,{color:"#b31d1d82",height:70,width:70,icon:"uiw:usergroup-delete"})," "]}),e.jsxs(o,{variant:"h3",mt:10,mb:14,children:["Bạn muốn giải tán ",l," này ?"]}),e.jsxs(r,{width:"100%",display:"flex",gap:6,marginTop:1,children:[e.jsxs(C,{onClick:t,sx:{width:"50%"},color:"primary",variant:"contained",children:[e.jsx(j,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(C,{type:"submit",sx:{width:"50%"},onClick:p,color:"error",variant:"contained",children:[e.jsx(j,{width:20,style:{marginRight:4},icon:"uiw:usergroup-delete"}),"Xóa nhóm"]})]})]})})}function X(i){const{rows:s,totalItems:l,totalPage:g,page:t,handleChangePage:u}=i,b=_(),[d,p]=h.useState({isOpen:!1,groupStudentId:"",groupStudentName:""}),T=(a,S)=>{p({groupStudentId:a,groupStudentName:S,isOpen:!0})},c=()=>{p(a=>({...a,isOpen:!1}))},m=[{headerName:"Tên nhóm",field:"name",flex:1,align:"left",headerAlign:"center"},{headerName:"Tên Đề tài",field:"name6",flex:3,headerAlign:"center",renderCell:a=>e.jsx(o,{children:a.row.topicName?a.row.topicName:"Chưa có đề tài"})},{headerName:"GV hướng dẫn",field:"name3",flex:1,align:"left",headerAlign:"center",renderCell:a=>e.jsx(o,{children:a.row.lecturerName?a.row.lecturerName:"Chưa có giảng viên HD"})},{headerName:"Số lượng thành viên",field:"name4",flex:1,align:"center",headerAlign:"center",renderCell:a=>e.jsxs(o,{children:[a.row.numOfMembers,"/2"]})},{headerName:"",field:"name8",flex:.5,align:"center",headerAlign:"center",renderCell:a=>e.jsxs(r,{display:"flex",gap:6,children:[e.jsx(R,{title:"Chi tiết",children:e.jsx(M,{color:"primary",onClick:()=>b(`/group-students/detail/${a.row.id}`),children:e.jsx(j,{icon:"clarity:file-group-line"})})}),e.jsx(R,{title:"Xóa nhóm",children:e.jsx(M,{color:"primary",onClick:()=>T(a.row.id,a.row.name),children:e.jsx(j,{width:20,icon:"uiw:usergroup-delete"})})})]})}],{onImportGroupStudent:v}=N(),{mutate:y}=v(),w=()=>{y()};return e.jsxs(r,{children:[e.jsx(z,{rows:s,sx:{bgcolor:"white"},columns:m,totalItems:l,totalPages:g,page:t,handleChangePage:u,noData:e.jsxs(C,{variant:"contained",onClick:w,children:["Tạo danh sách nhóm sinh viên"," "]}),disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0}),e.jsx(K,{groupStudentId:d.groupStudentId,groupStudentName:d.groupStudentName,open:d.isOpen,onClose:c})]})}const Y=i=>{if(!i)return[];const s=[];return i.map(l=>{s.push({...l,mssv:l.username,group:"NO_GROUP"})}),s};function $(i){const{nameGroup:s,handleSetData:l}=i,g=s,[t,u]=h.useState(),{handleGetStudentNoHaveGroup:b}=N(),{data:d,isLoading:p,isFetching:T,isSuccess:c}=b(),m=n=>{n.currentTarget.classList.add("dragged"),n.dataTransfer.setData("text/plain",n.currentTarget.id),n.dataTransfer.effectAllowed="move"},v=n=>{n.currentTarget.classList.remove("dragged")},y=n=>{n.preventDefault(),n.currentTarget.classList.add("dragged-over"),n.dataTransfer.dropEffect="move"},w=n=>{let x=n.currentTarget,f=n.relatedTarget;if(f.parentNode===x||f===x)return;n.preventDefault(),n.currentTarget.classList.remove("dragged-over")},a=n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},S=(n,x,f)=>{n.preventDefault(),n.currentTarget.classList.remove("dragged-over");let G=n.dataTransfer.getData("text/plain"),F=t==null?void 0:t.map(E=>(E.mssv.toString()===G.toString()&&(E.group=f),E));u(F)},D=t==null?void 0:t.filter(n=>n.group===s),O=t==null?void 0:t.filter(n=>n.group==="NO_GROUP");return h.useEffect(()=>{c&&u(Y(d==null?void 0:d.students))},[p,T]),h.useEffect(()=>{l(t==null?void 0:t.filter(n=>n.group===s))},[t]),e.jsx(r,{position:"relative",sx:{bgcolor:"white",py:4,px:8,borderRadius:4},children:e.jsxs(r,{className:"container",width:"full",display:"flex",gap:10,children:[e.jsxs(r,{flex:1,children:[e.jsxs(r,{alignItems:"center",gap:4,display:"flex",children:[e.jsx(o,{variant:"h5",fontWeight:"500",color:"primary.main",children:"Danh sách sinh viên"}),e.jsxs(C,{color:"success",children:[e.jsx(j,{width:20,icon:"fluent:filter-12-filled"}),"Filter"]})]}),e.jsx(r,{onDragLeave:n=>w(n),onDragEnter:n=>y(n),onDragEnd:n=>v(n),onDragOver:n=>a(n),onDrop:n=>S(n,!1,"NO_GROUP"),pr:10,sx:{maxHeight:400,overflowY:"auto","&::-webkit-scrollbar":{width:4},".MuiPaper-root":{pl:8,pr:8,py:0},"&::-webkit-scrollbar-thumb":{borderRadius:10,width:20,bgcolor:"grey.400",color:"grey.400"}},children:e.jsx(r,{className:"drag_container",children:e.jsx(r,{className:"container",children:e.jsx(r,{className:"drag_column",children:e.jsx(r,{className:"drag_row",children:O==null?void 0:O.map((n,x)=>e.jsx(r,{sx:{bgcolor:"grey.100",borderRadius:1,px:6,py:4,color:"white",my:4,border:"2px solid #fefefe",cursor:"pointer",":hover":{border:"2px solid #00B1A2",boxShadow:" rgba(0, 0, 0, 0.25) 0px 25px 50px -12px;",transition:"0.1s ease-in",backgroundColor:"#D3FFEF"}},id:n.mssv,draggable:!0,onDragStart:f=>m(f),onDragEnd:f=>m(f),onDrop:f=>S(f,!1,s),children:e.jsx(r,{gap:10,position:"relative",alignItems:"center",display:"flex",children:e.jsxs(r,{children:[e.jsx(o,{position:"absolute",right:10,top:2,bgcolor:"success.main",px:4,py:2,borderRadius:1,variant:"body2",color:"white",children:"Chưa có nhóm"}),e.jsxs(o,{variant:"h6",color:"primary.main",fontWeight:"500",children:[e.jsxs("span",{children:[" Họ và tên: ","   "]}),n.fullName]}),e.jsxs(o,{variant:"body2",color:"primary.dark",fontWeight:"500",children:[e.jsxs("span",{children:["Mã sinh vien: ","  "]})," ",n.mssv]})]})})},n.mssv))})})})})})]}),e.jsxs(r,{mt:20,flex:1,children:[e.jsx(r,{justifyContent:"space-between",display:"flex",mb:10,children:e.jsxs(o,{variant:"h4",fontWeight:"500",color:"error.main",children:["Nhóm sinh viên ",s]})}),e.jsx(r,{sx:{overflowY:"auto","&::-webkit-scrollbar":{width:4},".MuiPaper-root":{pl:8,pr:8,py:0},"&::-webkit-scrollbar-thumb":{borderRadius:10,width:20,bgcolor:"grey.400",color:"grey.400"},height:200},flex:1,onDragLeave:n=>w(n),onDragEnter:n=>y(n),onDragEnd:n=>v(n),onDragOver:n=>a(n),onDrop:n=>S(n,!1,s),children:e.jsx(r,{className:"drag_container",children:e.jsx(r,{className:"container",children:e.jsx(r,{className:"drag_column",children:e.jsx(r,{className:"drag_row",children:D==null?void 0:D.map(n=>e.jsx(r,{sx:{bgcolor:"grey.100",borderRadius:1,px:6,py:4,color:"white",my:4,border:"2px solid #fefefe",cursor:"pointer",":hover":{border:"2px solid #b11500",boxShadow:"1px 1px 1px 1px #E6E6E6",transition:"0.1s ease-in",backgroundColor:"#ffd5d3"}},id:n.mssv,draggable:!0,onDragStart:x=>m(x),onDragEnd:x=>m(x),children:e.jsx(r,{gap:10,position:"relative",alignItems:"center",display:"flex",children:e.jsxs(r,{children:[e.jsxs(o,{position:"absolute",right:10,top:2,bgcolor:"error.main",px:4,py:2,borderRadius:2,variant:"body2",color:"white",children:["Nhóm ",g]}),e.jsxs(o,{variant:"h6",color:"error.main",fontWeight:"500",children:[e.jsxs("span",{children:[" Họ và tên: ","   "]}),n.fullName]}),e.jsxs(o,{variant:"body2",color:"error.dark",fontWeight:"500",children:[e.jsxs("span",{children:["Mã sinh vien: ","  "]})," ",n.mssv]})]})})},n.mssv))})})})})}),e.jsxs(r,{mb:6,mt:14,pt:10,width:"full",justifyItems:"space-between",display:"flex",borderTop:"1px solid #56bae8",children:[e.jsxs(o,{flex:1,variant:"h6",color:"primary.main",fontWeight:"500",children:["Số lượng : ","      ",e.jsxs("span",{style:{color:"black"},children:[" ",D==null?void 0:D.length," / 2"]})]}),D&&D.length>2&&e.jsxs(o,{variant:"body1",color:"warning.dark",children:[e.jsx(j,{icon:"twemoji:warning"}),"Nhóm sinh viên tối đa 2 thành viên"]})]})]})]})})}function q(i){const{onClose:s,open:l}=i,{handleGetCountOfGroupStudent:g,onCreateGroupStudent:t}=N(),{data:u,isFetching:b,isLoading:d,isSuccess:p}=g(),{mutate:T,isSuccess:c}=t(),[m,v]=h.useState([]),y=a=>{v(a)},w=()=>{const a=m.map(S=>S.studentId);T(a)};return h.useEffect(()=>{c&&s()},[c]),e.jsx(P,{maxWidth:"xl",open:l,onClose:s,children:e.jsxs(r,{p:10,children:[e.jsx(k,{mb:10,variant:"h4",textTransform:"uppercase",children:"Tạo Nhóm sinh viên mới"}),d||b?e.jsx(I,{}):e.jsxs(e.Fragment,{children:[e.jsx(r,{children:e.jsx(W,{label:"Tên nhóm sinh viên",disabled:!0,value:p?u.nameCount:""})}),e.jsxs(L,{elevation:1,sx:{mt:10,p:10},children:[e.jsx($,{handleSetData:y,nameGroup:p?u.nameCount:""}),e.jsx(o,{mt:4,variant:"body1",color:"error",children:"**Chú thích: Kéo thả sinh viên trong danh sách sinh viên sang nhóm mới để thêm sinh viên vào nhóm."})]})]}),e.jsxs(r,{mt:10,justifyContent:"end",gap:4,display:"flex",children:[e.jsxs(C,{variant:"contained",color:"primary",onClick:s,children:[e.jsx(j,{icon:"mdi:close-outline"}),"Hủy"]}),e.jsxs(C,{onClick:w,variant:"contained",color:"success",children:[e.jsx(j,{icon:"material-symbols:save-outline"}),"Lưu thông tin"]})]})]})})}function V(){const[i,s]=h.useState(!1),l=()=>{s(!1)},g=()=>{s(!0)};return e.jsxs(r,{mb:4,display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(r,{flex:1,display:"flex",gap:4,width:"full",children:[e.jsx(r,{width:200,children:e.jsx(A,{placeholder:"Tìm kiếm theo",options:[]})}),e.jsx(B,{fullWidth:!0,size:"small",placeholder:"Tim kiếm  nhom sinh viên theo.."})]}),e.jsxs(C,{size:"small",onClick:g,color:"error",type:"button",variant:"contained",children:[e.jsx(j,{icon:"lets-icons:add-round",width:20}),"Tạo nhóm sinh viên"]}),e.jsx(q,{open:i,onClose:l})]})}const Z=H.memo(V);function oe(){const{handleManagerRenderActionGroupStudent:i,params:s}=N(),[l,g]=h.useState(10),[t,u]=h.useState(s.page),[b,d]=h.useState(""),[p,T]=h.useState(U.ALL),{data:c,isLoading:m,isFetching:v}=i(l,t,p,b),y=w=>{u(w)};return e.jsxs(L,{sx:{py:10,px:10},elevation:1,children:[e.jsx(r,{display:"flex",justifyContent:"space-between",children:e.jsx(k,{icon:"quill:list",mb:8,mt:2,children:"Danh sách nhóm sinh viên"})}),e.jsx(Z,{}),m||v?e.jsx(I,{}):e.jsx(X,{totalPage:s.totalPage,totalItems:c==null?void 0:c.groupStudents.length,handleChangePage:y,page:t,rows:c?c.groupStudents:[]})]})}export{oe as default};
