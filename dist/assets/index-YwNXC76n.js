import{j as e,P as E,T as M,a as s,aa as $,B as r,I as p,aG as z,aH as q,aI as K,ai as I,ao as Y,ad as N,ax as X,ay as O,az as f,r as g,aJ as A,al as J,a5 as y,ah as D,aK as Z,A as ee,E as F}from"./index-wQ8JwfM2.js";import{G as te}from"./index-owcxqeif.js";import{A as ne,D as P,T as re,a as _}from"./Table-cDawzk-H.js";import{a as R}from"./index-k6g5FF0C.js";import{g as se,Q as T,d as ie,a as ae,u as H}from"./useQueryGroupStudent-U8YA793n.js";import{u as oe}from"./apiStudent-mO15R6c8.js";import{a as le,b as de,T as L}from"./TabPanel-krTzuP6C.js";import{a as W}from"./Tabs-hwighDjN.js";import"./KeyboardArrowRight-yT4WKBtg.js";import"./Stack-xq_Pr2sx.js";function ce(a){var l;const{groupStudent:t}=a;return e.jsxs(e.Fragment,{children:[e.jsxs(E,{variant:"elevation",sx:{mt:1,py:12,px:8},children:[e.jsx(M,{icon:"flat-color-icons:info",fontWeight:600,mb:4,textTransform:"uppercase",variant:"h6",children:"Chi tiết nhóm"}),e.jsxs(s,{color:"text.primary",variant:"body1",children:["Giảng viên Hướng dẫn :"," ",t.lecturerId?t.lecturerId:"Chưa có giảng viên hướng dẫn"]}),e.jsxs(s,{color:"text.primary",variant:"body1",children:["Ngày tạo nhóm : ",$(t.created_at).format("DD/MM/YYYY")]})]}),e.jsxs(r,{position:"relative",my:8,children:[e.jsx(r,{sx:{position:"absolute",top:10,zIndex:10,left:"-20px"},children:e.jsx(p,{width:50,color:"#122E69",icon:"game-icons:achievement"})}),e.jsxs(z,{sx:{px:10},defaultExpanded:!0,children:[e.jsx(q,{expandIcon:e.jsx(te,{color:"primary"}),"aria-controls":"panel-topic-content",id:"panel-topic-header",children:e.jsx(M,{variant:"h6",textTransform:"uppercase",fontWeight:600,children:"Thông tin đề tài"})}),e.jsx(K,{children:t.topic?e.jsxs(r,{pb:8,children:[e.jsxs(s,{variant:"h3",textAlign:"center",fontWeight:600,color:"grey.900",children:["Tên đề tài: ","  "," ",t==null?void 0:t.topic.name]}),e.jsxs(s,{my:4,fontWeight:500,variant:"h6",children:["Mô tả",e.jsx(I,{disabled:!0,multiline:!0,value:t==null?void 0:t.topic.description,maxRows:8}),e.jsx(s,{fontWeight:400,px:2,variant:"body1"})]}),e.jsx(I,{multiline:!0,disabled:!0,value:(l=t==null?void 0:t.topic)==null?void 0:l.expectedResult,maxRows:8,label:"Dự kiến sản phẩm nghiên cứu của Đề tài và khả năng ứng dụng",placeholder:"Dự kiến sản phẩm nghiên cứu của Đề tài và khả năng ứng dụng"}),e.jsxs(s,{my:4,fontWeight:500,variant:"h6",children:["Mục tiêu cần đạt được",e.jsx(I,{disabled:!0,multiline:!0,value:t==null?void 0:t.topic.target,maxRows:8})]}),e.jsxs(s,{my:4,fontWeight:500,variant:"h6",children:["Yêu cầu đầu vào",e.jsx(I,{disabled:!0,multiline:!0,value:t==null?void 0:t.topic.require_input,maxRows:8})]}),e.jsxs(s,{my:4,fontWeight:500,variant:"h6",children:["Chuẩn đầu ra",e.jsx(I,{disabled:!0,multiline:!0,value:t==null?void 0:t.topic.standard_output,maxRows:12}),e.jsx(s,{fontWeight:400,px:2,variant:"body1"})]})]}):e.jsxs(r,{mx:"auto",display:"flex",flexDirection:"column",alignContent:"center",justifyContent:"center",textAlign:"center",py:20,width:"100%",children:[e.jsx(r,{children:e.jsx("img",{style:{opacity:.7},width:200,height:200,src:"/images/nodata.png",alt:"nodata"})}),e.jsx(s,{variant:"h3",sx:{mt:2},children:"Nhóm chưa có Đề tài"})]})})]})]})]})}const ue=a=>{switch(a){case"OPEN":return"Đang học";case"FAIL_ADVISOR":return"Rớt hướng dẫn";case"FAIL_REVIEWER":return"Rớt phản biện";case"FAIL_SESSION_HOST":return"Rớt hội đồng";case"PASS_ADVISOR":return"Đậu hướng dẫn";case"PASS_REVIEWER":return"Đậu phản biện";case"PASS_SESSION_HOST":return"Đậu hội dồng"}},G=()=>{const{enqueueSnackbar:a}=Y(),{termStore:t}=N();return{handleGetMemberInGroupStudent:i=>X(["getMemberInGroupStudent",i],()=>se(i)),onDeleteStudentMember:i=>O(c=>ie(i,c),{onSuccess(){a("Xóa sinh viên khỏi nhóm thành công",{variant:"success"}),f.invalidateQueries({queryKey:["getMemberInGroupStudent",i]}),f.invalidateQueries([T.getStudentsNohaveGroup,t.currentTerm.id]),f.invalidateQueries([T.getCountOfGroupStudent,t.currentTerm.id])}}),onAddStudentMember:i=>O(c=>ae(i,{...c,termId:t.currentTerm.id}),{onSuccess(){a("Thêm sinh viên vào nhóm thành công",{variant:"success"}),f.invalidateQueries({queryKey:["getMemberInGroupStudent",i]}),f.invalidateQueries([T.getStudentsNohaveGroup,t.currentTerm.id]),f.invalidateQueries([T.getCountOfGroupStudent,t.currentTerm.id])}}),onUpdateStatusStudentMember:(i,c)=>O(x=>oe(c,x),{onSuccess(x){x.success&&a("Cập nhật trạng thái sinh viên thành công",{variant:"success"}),f.invalidateQueries({queryKey:["getMemberInGroupStudent",i]})},onError(){a("Cập nhật sinh viên thất bại, thử lại",{variant:"error"})}})}},he=[{_id:"OPEN",name:"Đang học"},{_id:"PASS_SESSION_HOST",name:"Đậu hội dồng"}];function me(a){const{onClose:t,open:l,studentId:m,status:o}=a,[d,i]=g.useState(o),{termStore:c}=N(),{pathname:x}=A(),v=x.split("/"),b=`${v[v.length-1]}`,{onUpdateStatusStudentMember:j}=G(),{mutate:C,isSuccess:w}=j(b,m);g.useEffect(()=>{t()},[w]);const u=()=>{C({status:d,termId:c.currentTerm.id})};return e.jsx(R,{open:l,onClose:t,children:e.jsxs(r,{m:10,children:[e.jsx(s,{mb:4,fontWeight:600,variant:"h3",children:"Cập nhật trạng thái sinh viên"}),e.jsx(r,{my:10,children:e.jsx(J,{onChange:S=>{i(S.target.value)},value:d,options:he})}),e.jsxs(r,{mt:12,sx:{display:"flex",gap:3},children:[e.jsxs(y,{onClick:t,sx:{width:"50%"},variant:"contained",color:"primary",children:[e.jsx(p,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(y,{type:"submit",sx:{width:"50%"},onClick:u,variant:"contained",color:"success",children:[e.jsx(p,{width:20,icon:"radix-icons:update"}),"Cập nhật"]})]})]})})}function xe(a){const{onClose:t,open:l,studentId:m}=a,{termStore:o}=N(),{pathname:d}=A(),i=d.split("/"),c=`${i[i.length-1]}`,{onDeleteStudentMember:x}=G(),{mutate:v,isSuccess:b}=x(c),j=()=>{v({studentId:m,termId:o.currentTerm.id})};return g.useEffect(()=>{t()},[b]),e.jsx(R,{onClose:t,open:l,children:e.jsxs(r,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",px:10,py:12,children:[e.jsxs(r,{borderRadius:"50%",width:100,height:100,display:"flex",alignItems:"center",justifyContent:"center",sx:{background:"rgba(255,49,111,0.2)"},children:[e.jsx(p,{color:"#b31d1d82",width:70,icon:"fluent-mdl2:leave"})," "]}),e.jsx(s,{variant:"h3",mt:10,mb:14,children:"Xóa sinh viên ra khỏi nhóm ?"}),e.jsxs(r,{width:"100%",display:"flex",gap:6,marginTop:1,children:[e.jsxs(y,{onClick:t,sx:{width:"50%"},color:"primary",variant:"contained",children:[e.jsx(p,{width:20,style:{marginRight:4},icon:"mdi:cancel-outline"}),"Hủy"]}),e.jsxs(y,{onClick:j,type:"submit",sx:{width:"50%"},color:"error",variant:"contained",children:[e.jsx(p,{width:20,style:{marginRight:4},icon:"fluent-mdl2:leave"}),"Xóa Sinh viên"]})]})]})})}const pe=a=>a?a.map(t=>({label:`${t.username+" - "+t.fullName}`,id:t.studentId})):[];function ge(a){const{onClose:t,open:l,groupStudentId:m}=a,[o,d]=g.useState({label:"",id:""}),{handleGetStudentNoHaveGroup:i}=H(),{data:c,isLoading:x,isFetching:v}=i(),{onAddStudentMember:b}=G(),{mutate:j,isSuccess:C}=b(m);g.useEffect(()=>{t()},[C]),g.useEffect(()=>{l||d({label:"",id:""})},[l]);const w=u=>{const S={studentId:u.id};j(S)};return e.jsx(R,{open:l,onClose:t,children:e.jsxs(r,{py:10,px:10,children:[e.jsx(M,{mb:8,variant:"h5",textTransform:"uppercase",children:"Thêm Sinh viên vào nhóm"}),e.jsx(r,{height:"350px",children:x||v?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{disablePortal:!0,id:"Student-terms-list",options:pe(c.students),onChange:(u,S)=>{d(S)},renderInput:u=>e.jsx(e.Fragment,{children:e.jsx(I,{...u,placeholder:"Nhập vào tên sinh viên",label:"Danh sách sinh viên HD khoa CNTT"})})}),e.jsxs(r,{children:[e.jsx(s,{textTransform:"uppercase",mt:20,mb:4,variant:"body1",fontWeight:"bold",children:"Thông tin sinh viên"}),!o||(o==null?void 0:o.id)===""?e.jsx(e.Fragment,{children:e.jsx(s,{my:10,textAlign:"center",variant:"body1",color:"initial",children:"Chưa chọn sinh viên nào..."})}):e.jsx(r,{children:c==null?void 0:c.students.filter(u=>u.studentId===(o==null?void 0:o.id)).map(u=>e.jsxs(E,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",p:3,borderRadius:2,boxShadow:1,mt:4},children:[e.jsx(s,{variant:"h6",component:"div",gutterBottom:!0,sx:{fontWeight:"500",my:4},children:u.fullName}),e.jsx(P,{sx:{width:"100%",mb:2}}),e.jsx(r,{sx:{my:6},children:e.jsxs(s,{variant:"body1",color:"text.primary",children:[e.jsx("strong",{children:"Mã SV:"})," ",u.username]})}),e.jsx(P,{sx:{width:"100%",mb:2}}),e.jsx(s,{variant:"body2",color:"primary.dark",children:u.nameSelect})]}))})]})]})}),e.jsxs(r,{mt:10,justifyContent:"end",gap:4,display:"flex",children:[e.jsxs(y,{variant:"contained",color:"primary",onClick:t,children:[e.jsx(p,{icon:"mdi:close-outline"}),"Hủy"]}),e.jsxs(y,{variant:"contained",color:"success",onClick:()=>w(o),type:"submit",children:[e.jsx(p,{icon:"material-symbols:save-outline"}),"Thêm sinh viên"]})]})]})})}function je(a){const{pathname:t}=A(),l=t.split("/"),m=`${l[l.length-1]}`,{handleGetMemberInGroupStudent:o}=G(),{data:d,isLoading:i}=o(m),[c,x]=g.useState(!1),v=()=>{x(!0)},b=()=>{x(!1)},[j,C]=g.useState({isOpen:!1,studentId:"",status:""}),w=(n,h)=>{C({studentId:n,status:h,isOpen:!0})},u=(n,h)=>{C(V=>({...V,isOpen:!1}))},[S,k]=g.useState({studentId:"",isOpen:!1}),Q=()=>{k({...S,isOpen:!1})},B=n=>{k({studentId:n,isOpen:!0})},U=[{headerName:"Thông tin chung",field:"name",flex:1.7,headerAlign:"center",renderCell:n=>e.jsxs(r,{gap:4,display:"flex",alignItems:"center",children:[e.jsx(ee,{sizes:"small",src:n.row.avatar}),e.jsxs(r,{children:[e.jsx(s,{component:"span",color:"primary",children:n.row.isAdmin?"Trưởng Nhóm":""}),e.jsx(s,{fontWeight:600,variant:"body1",children:n.row.fullName}),e.jsxs(s,{children:["Mã SV: ","  ",e.jsx(s,{component:"span",children:n.row.username})]})]})]})},{headerName:"Lớp chuyên ngành",field:"clazzName",flex:1,align:"center",headerAlign:"center"},{headerName:"Điểm Hướng dẫn",field:"hd",flex:1,align:"center",headerAlign:"center",renderCell:n=>{var h;return e.jsx(s,{variant:"body1",children:n.row.transcripts.length>0&&n.row.transcripts[0]?`${parseFloat((h=n.row.transcripts[0])==null?void 0:h.avgScore.toFixed(2))}`:"Chưa có"})}},{headerName:"Điểm Phản biện",field:"pb",flex:1,align:"center",headerAlign:"center",renderCell:n=>{var h;return e.jsx(s,{variant:"body1",children:n.row.transcripts.length>0&&n.row.transcripts[1]?`${parseFloat((h=n.row.transcripts[1])==null?void 0:h.avgScore.toFixed(2))}`:"Chưa có"})}},{headerName:"Điểm Báo cáo",field:"bc",flex:1,align:"center",headerAlign:"center",renderCell:n=>{var h;return e.jsx(s,{variant:"body1",children:n.row.transcripts.length>0&&n.row.transcripts[2]?`${parseFloat((h=n.row.transcripts[2])==null?void 0:h.avgScore.toFixed(2))}`:"Chưa có"})}},{headerName:"Điểm Trung bình",field:"tb",flex:1,align:"center",headerAlign:"center",renderCell:n=>{var h;return e.jsx(s,{variant:"body1",children:n.row.transcripts.length>0&&n.row.transcripts[3]?`${parseFloat((h=n.row.transcripts[3])==null?void 0:h.avgScore.toFixed(2))}`:"Chưa có"})}},{headerName:"Tình trạng",field:"abc",flex:1,align:"center",headerAlign:"center",renderCell:n=>e.jsxs(r,{display:"flex",children:[e.jsx(s,{variant:"body1",children:ue(n.row.status)}),e.jsx(_,{title:"Cập nhật trạng thái sinh viên",children:e.jsx(F,{size:"small",onClick:()=>w(n.row.id,n.row.status),children:e.jsx(p,{width:16,icon:"fluent-mdl2:global-nav-button-active"})})})]})},{headerName:"",field:"name8",flex:1,align:"center",headerAlign:"center",renderCell:n=>e.jsx(r,{display:"flex",gap:2,children:e.jsx(_,{title:"Cho rời nhóm",children:e.jsx(F,{size:"small",color:"primary",onClick:()=>B(n.row.id),children:e.jsx(p,{icon:"pepicons-print:leave-circle",width:20})})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(r,{children:i?e.jsx(D,{}):e.jsxs(r,{children:[e.jsx(r,{display:"flex",mt:6,mb:4,justifyContent:"end",children:e.jsxs(y,{disabled:(d==null?void 0:d.members.length)>=2,size:"small",color:"error",variant:"contained",onClick:v,children:[e.jsx(p,{icon:"material-symbols:add",width:16,style:{marginRight:4}}),"Thêm Sinh viên"]})}),e.jsx(re,{rows:Z(d==null?void 0:d.members),sx:{bgcolor:"white",height:350},minHeight:350,rowHeight:100,columns:U,totalItems:1,totalPages:1,page:1,handleChangePage:()=>{},disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0})]})}),e.jsx(me,{open:j.isOpen,studentId:j.studentId,status:j.status,onClose:u}),e.jsx(xe,{studentId:S.studentId,open:S.isOpen,onClose:Q}),e.jsx(ge,{groupStudentId:m,onClose:b,open:c})]})}function Se(){return e.jsx(r,{children:e.jsx(je,{})})}function ve(a){const{groupStudent:t}=a,[l,m]=g.useState("1"),o=(d,i)=>{m(i)};return e.jsx(r,{sx:{width:"100%",typography:"h4"},children:e.jsxs(le,{value:l,children:[e.jsx(r,{sx:{borderBottom:1,borderColor:"primary.main"},children:e.jsxs(de,{onChange:o,"aria-label":"lab API tabs example",children:[e.jsx(W,{label:"Thông tin chung",value:"1"}),e.jsx(W,{label:"Danh sách sinh viên",value:"2"})]})}),e.jsx(L,{value:"1",children:e.jsx(ce,{groupStudent:t})}),e.jsx(L,{value:"2",children:e.jsx(Se,{})})]})})}function Oe(){const{pathname:a}=A(),t=a.split("/"),l=`${t[t.length-1]}`,{handleGetGroupStudentById:m}=H(),{data:o,isLoading:d,isFetching:i}=m(l);return e.jsx(E,{sx:{py:10,px:10},elevation:1,children:d||i?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:"mingcute:group-fill",children:o.groupStudent.name}),e.jsx(r,{mt:4,children:e.jsx(ve,{groupStudent:o.groupStudent})})]})})}export{Oe as default};
