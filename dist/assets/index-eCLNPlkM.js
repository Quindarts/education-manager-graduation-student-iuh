import{aw as b,ao as B,ax as A,ay as L,az as R,r as E,j as e,B as c,a as i,c as M,a5 as C,I as f,b2 as m,u as U,T as S,ah as D,P as k,aB as G,bi as T,E as I}from"./index-wQ8JwfM2.js";import{T as P,a as N}from"./Table-cDawzk-H.js";import{a as O}from"./index-k6g5FF0C.js";import"./KeyboardArrowRight-yT4WKBtg.js";import"./index-owcxqeif.js";import"./Stack-xq_Pr2sx.js";const F=()=>b.get("/api/v1/roles"),H=t=>b.post("/api/v1/roles",t),Q=t=>b.delete(`/api/v1/roles/${t}`),z=t=>b.get(`/api/v1/roles/lecturer/${t}`),v=()=>{const{enqueueSnackbar:t}=B();return{onAssignRoleToLecturer:s=>L(l=>H(l),{onSuccess(){t("Phân vai trò thành công",{variant:"success"}),R.invalidateQueries({queryKey:["getAllRoleLecturer"]}),R.invalidateQueries({queryKey:["getRoleDetailByLecturerId",s]})},onError(l){t("Phân vai trò thất bại",{variant:"error"})}}),onUnAssignRoleToLecturer:s=>L(l=>Q(l),{onSuccess(){t("Hủy phân vai trò thành công",{variant:"success"}),R.invalidateQueries({queryKey:["getAllRoleLecturer"]}),R.invalidateQueries({queryKey:["getRoleDetailByLecturerId",s]})},onError(l){t("Xóa vai trò thất bại vui lòng thử lại sau",{variant:"error"})}}),handleGetAllRoleLecturer:()=>A(["getAllRoleLecturer"],()=>F(),{onSuccess(s){},staleTime:1e4}),handleGetRoleDetailByLecturerId:s=>A(["getRoleDetailByLecturerId",s],()=>z(s),{enabled:!!s})}};function K(t){var o;const{roleAssigned:r,roleName:d,handleClose:u,lecturerId:h}=t,{onAssignRoleToLecturer:s,onUnAssignRoleToLecturer:l}=v(),{mutate:a,isSuccess:x}=l(h),{mutate:y,isSuccess:g}=s(h),p=()=>{y({name:d,lecturerId:h})},n=()=>{a(r.id)};return E.useEffect(()=>{(x||g)&&u()},[g,x]),e.jsxs(c,{bgcolor:r?"#f9fcff":"grey.100",borderRadius:2,border:r?"2px solid #c4daf7":"2px solid #eaeaea",my:2,py:4,px:10,sx:{cursor:"pointer","&:hover":{boxShadow:"rgba(0, 0, 0, 0.07) 0px 1px 2px, rgba(0, 0, 0, 0.07) 0px 2px 4px, rgba(0, 0, 0, 0.07) 0px 4px 8px, rgba(0, 0, 0, 0.07) 0px 8px 16px, rgba(0, 0, 0, 0.07) 0px 16px 32px, rgba(0, 0, 0, 0.07) 0px 32px 64px;",bgcolor:"#fff5dfdf",color:"white",transition:"0.2s ease-in",border:"2px solid #d0963e"}},children:[e.jsxs(c,{children:[e.jsxs(i,{mb:4,variant:"body1",color:"primary.dark",children:[e.jsxs(i,{variant:"h6",mr:4,fontWeight:"500",component:"span",color:"grey.700",children:["  ","Tên vai trò:"]}),(o=M(d))==null?void 0:o.toUpperCase()]}),e.jsx(e.Fragment,{children:r&&e.jsx(i,{borderRadius:4,textAlign:"center",width:100,color:"success.main",py:2,px:4,variant:"body1",bgcolor:"#cafae5",children:"Có quyền"})})]}),e.jsx(c,{gap:4,justifyContent:"end",display:"flex",children:(r==null?void 0:r.name)!=="LECTURER"&&e.jsx(e.Fragment,{children:r?e.jsxs(C,{onClick:n,color:"error",children:["Gỡ quyền",e.jsx(f,{icon:"icomoon-free:exit"})]}):e.jsxs(C,{onClick:p,color:"primary",children:["Trao quyền",e.jsx(f,{icon:"typcn:tick"})]})})})]})}const w=[m.ADMIN,m.HEAD_LECTURER,m.LECTURER,m.HEAD_COURSE];function W(t){const{onClose:r,open:d,lecturerId:u,lecturerName:h,username:s}=t,{handleGetRoleDetailByLecturerId:l}=v(),{data:a,isLoading:x,isFetching:y}=l(u),{lecturerStore:g}=U(),p=g.currentRoleRender,n=p===m.ADMIN?w:w.filter(o=>o!==m.ADMIN);return e.jsx(O,{maxWidth:"md",open:d,onClose:r,children:e.jsxs(c,{py:10,px:10,children:[e.jsx(S,{mb:8,icon:"tdesign:user-setting",variant:"h5",textTransform:"uppercase",children:"Cập nhật vai trò (quyền)"}),x||y?e.jsx(D,{}):e.jsx(e.Fragment,{children:e.jsxs(k,{sx:{px:6,py:4},elevation:1,children:[e.jsxs(c,{mb:6,children:[e.jsxs(i,{variant:"h5",color:"grey.700",children:["Tên GV: ",h]}),e.jsxs(i,{variant:"h5",color:"grey.700",children:["Mã giảng viên: ",s]})]}),n.map((o,j)=>e.jsx(K,{lecturerId:u,roleAssigned:a&&(a==null?void 0:a.roles.filter(q=>q.name===o)[0]),roleName:o,handleClose:r,currentRole:p},j))]})}),e.jsx(c,{mt:10,justifyContent:"end",gap:4,display:"flex",children:e.jsxs(C,{variant:"contained",color:"primary",onClick:r,children:[e.jsx(f,{icon:"mdi:close-outline"}),"Thoát"]})})]})})}function _(t){const{rows:r,totalItems:d,totalPage:u,page:h,handleChangePage:s}=t,l=G(),[a,x]=E.useState({lecturerId:"",lecturerName:"",username:"",isOpen:!1}),y=()=>{x({...a,isOpen:!1})},g=(n,o,j)=>{x({lecturerId:n,lecturerName:o,username:j,isOpen:!0})},p=[{headerName:"Mã Giảng Viên",field:"username",flex:.6,headerAlign:"center",align:"center",renderCell(n){return e.jsx(i,{variant:"body1",fontWeight:600,color:"primary",children:n.row.username})}},{headerName:"Họ & Tên đệm",field:"firstName",flex:.7,headerAlign:"center",renderCell(n){return e.jsx(i,{variant:"body1",color:"initial",children:n.row.fullName.trim().split(" ").slice(0,-1).join(" ")})}},{headerName:"Tên",field:"lastname",flex:.5,headerAlign:"center",align:"center",renderCell(n){return e.jsx(i,{variant:"body1",color:"initial",children:n.row.fullName.trim().split(" ").pop()})}},{headerName:"Chuyên ngành",field:"none2",flex:1,headerAlign:"center",align:"center",renderCell:n=>e.jsx(i,{variant:"body1",children:n.row.majorName})},{headerName:"Quyền người dùng",field:"myRole",flex:2,headerAlign:"center",renderCell:n=>e.jsx(c,{display:"flex",flexWrap:"wrap",gap:4,children:n.row.roles.map(o=>e.jsxs(i,{display:"flex",color:T(o),alignItems:"center",justifyItems:"center",gap:2,bgcolor:"grey.300",px:4,py:2,borderRadius:3,variant:"body1",children:[e.jsx(i,{borderRadius:"50%",width:10,height:10,bgcolor:T(o),variant:"body1",color:"initial"}),M(o)]}))})},{headerName:"",field:"updateTing",flex:1,headerAlign:"center",align:"center",renderCell:n=>e.jsxs(c,{display:"flex",gap:2,children:[e.jsx(N,{title:"Cập nhật quyền",onClick:()=>g(n.row.id,n.row.fullName,n.row.username),children:e.jsx(I,{size:"small",children:e.jsx(f,{icon:"uiw:setting"})})}),e.jsx(c,{}),e.jsx(N,{title:"Xem Chi tiết quyền",children:e.jsx(I,{color:"primary",size:"small",onClick:()=>l(`/authorizations/lecturers?lecturerId=${n.row.id}`),children:e.jsx(f,{width:20,icon:"mdi:card-account-details-star-outline"})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(c,{children:e.jsx(P,{rows:r,sx:{bgcolor:"white",width:"100%"},rowHeight:80,columns:p,totalItems:d,totalPages:u,page:h,handleChangePage:s,disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0,minHeight:400})}),e.jsx(W,{open:a.isOpen,lecturerName:a.lecturerName,username:a.username,lecturerId:a.lecturerId,onClose:y})]})}function ee(){const{handleGetAllRoleLecturer:t}=v(),{data:r,isLoading:d,isFetching:u}=t();return e.jsxs(k,{sx:{p:10},children:[e.jsx(S,{sx:{mb:8},icon:"heroicons:user-group",children:"Danh sách Người dùng"}),u||d?e.jsx(D,{}):e.jsx(_,{rows:r!=null&&r.roles?r.roles:[]})]})}export{ee as default};
